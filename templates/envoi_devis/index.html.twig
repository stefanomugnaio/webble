{% extends 'base.html.twig' %}

{% block title %}Devis - {{ offer.label }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {{ encore_entry_link_tags('envoi_devis') }}

    <style>
        .gray-row {
            opacity: 0.4;
            transition: opacity 0.25s ease-in-out;
        }
    </style>
{% endblock %}

{% block body %}
<section class="text-white py-5 d-flex align-items-center fs-5" style="min-height: 100vh;">
    <div class="container py-4 fs-5">

        <div class="row justify-content-center">
            <div class="col-lg-8">

                <div class="mb-4 text-center">
                    <p class="text-uppercase small text-secondary mb-1">Demande de devis</p>
                    <h1 class="h3 fw-bold mb-2">Offre {{ offer.label }}</h1>
                    <p class="text-secondary mb-0">{{ offer.description }}</p>
                </div>

                {{ form_start(form) }}

                {# -------------------------------------------------------------------------- #}
                {#  COORDONNÉES                                                               #}
                {# -------------------------------------------------------------------------- #}
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h2 class="h5 fw-semibold mb-3">Vos coordonnées</h2>

                        <div class="row g-3">
                            {% for field in ['nom','prenom','email','telephone','adresse','code_postal','ville'] %}
                                <div class="col-md-{{ field in ['adresse','ville'] ? '12' : '6' }}">
                                    {{ form_label(attribute(form, field)) }}
                                    {{ form_widget(attribute(form, field), { attr: { class: 'form-control' }}) }}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                {# -------------------------------------------------------------------------- #}
                {#  CE QUE COMPREND L’OFFRE                                                   #}
                {# -------------------------------------------------------------------------- #}
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h2 class="h5 fw-semibold mb-3">Ce que comprend l’offre {{ offer.label }}</h2>
                        <ul class="list-unstyled text-muted small mb-0">
                            {% for feature in offer.features %}
                                <li class="mb-2">
                                    <i class="bi bi-check-circle-fill text-success me-2"></i>
                                    {{ feature }}
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>

                {# -------------------------------------------------------------------------- #}
                {#  RÉCAPITULATIF                                                             #}
                {# -------------------------------------------------------------------------- #}
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">

                        <h4 class="mb-4">Récapitulatif</h4>

                        {# -- Bloc maintenance -- #}
                        <div class="my-5 bg-light p-3 rounded">
                            {{ form_widget(form.contrat_maintenance, {
                                attr: { class: 'form-check-input' }
                            }) }}

                            {{ form_label(form.contrat_maintenance, null, {
                                label_attr: { class: 'form-check-label ms-2' }
                            }) }}

                            <p class="small text-muted mt-2 mb-0">
                                Le contrat de maintenance comprend la surveillance technique, les mises à jour
                                de sécurité, les correctifs en cas de problème, et un accompagnement pour les
                                petites modifications du contenu.
                            </p>
                        </div>

                        {% if montant_ht is not null %}

                            <script>
                                window.montantSiteHT = {{ montant_ht }};
                                window.maintenanceHT = {{ maintenance_ht_an }};
                                window.tauxTVA = 0.20;
                                window.offerLabel = "{{ offer.label }}";
                            </script>

                            <div class="row mb-2">
                                <div class="col-7 text-muted small">Site web (HT)</div>
                                <div class="col-5 text-end fw-semibold">
                                    {{ montant_ht|number_format(2, ',', ' ') }} €
                                </div>
                            </div>

                            <div id="maintenanceRow" class="row mb-3 align-items-center gray-row">
                                <div class="col-7 small">
                                    {% if offer.label == "Sérieuse" %}
                                        Contrat de maintenance (3 mois offerts)
                                    {% else %}
                                        Contrat de maintenance annuelle
                                    {% endif %}
                                </div>
                                <div class="col-5 text-end fw-semibold" id="maintenanceAmount">0,00 €</div>
                            </div>

                            <hr>

                            <div class="row mb-2">
                                <div class="col-6 text-muted small">TVA (20 %)</div>
                                <div class="col-6 text-end fw-semibold" id="tvaAmount">
                                    {{ montant_tva_total|number_format(2, ',', ' ') }} €
                                </div>
                            </div>

                            <div class="row mb-1">
                                <div class="col-6 fw-bold">Total TTC</div>
                                <div class="col-6 text-end fw-bold" id="totalTtc">
                                    {{ montant_ttc_total|number_format(2, ',', ' ') }} €
                                </div>
                            </div>

                        {% endif %}

                        {# -------------------------------------------------------------------------- #}
                        {#  RGPD (LABEL HTML MANUEL — TAILLE OK AVEC FS-5)                          #}
                        {# -------------------------------------------------------------------------- #}
                        <div class="mt-4">

                            <div class="form-check d-flex align-items-start">

                                {{ form_widget(form.rgpd, {
                                    attr: { class: 'form-check-input mt-1' }
                                }) }}

                                <label class="ms-2 fs-5"><!-- texte contrôlé -->
                                    J'ai lu et j'accepte la <a href="{{ path('app_politique_confidentialite') }}" class="text-decoration-underline">
                                    politique de confidentialité
                                </a>
                                </label>

                            </div>

                           

                        </div>

                    </div>
                </div>

                <div class="text-center">
                    <button type="submit" class="btn btn-primary rounded-pill px-4">
                        Envoyer ma demande de devis
                    </button>
                </div>

                {{ form_end(form) }}

                <div class="text-center mt-4">
                    <a href="{{ path('app_creation_site') }}" class="btn btn-outline-light rounded-pill px-4">
                        Retour aux formules
                    </a>
                </div>

            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('envoi_devis') }}
{% endblock %}
